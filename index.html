<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>I Love You</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.4/dist/sweetalert2.all.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://dekatutorial.github.io/slide/dekatutorialstyle.css" />
</head>
<body>
  <div class="open">
    <div class="left"></div>
    <div class="right"></div>
    <div class="content">
      <div class="lock">
        <div class="top"></div>
        <div class="bottom"></div>
      </div>
    </div>
    <div class="text">
      <p>Klik Gemboknya</p>
    </div>
  </div>
  
  <div id="slider" class="slider">
    <div class="wrapper">
      <div class="bg"></div>
      <div id="items" class="items">
        <div>
          <img src="/hbd1.gif" />
          <p>hallo mei sayang<p>geser ke samping ya</p></p>
        </div>
        <div>
          <img src="https://raw.githubusercontent.com/slavadirta/hbd.github.io/refs/heads/main/hbd1.gif" />
          <p>selamat ulang tahun Mei ku sayang</p>
        </div>
        <div>
          <img src="/hbd2.gif" />
          <p>ciee yang bertambah umur, horee horee horeeee</p>
        </div>
        <div>
          <img src="/hbd3.gif" />
          <p>semoga tercapai segala keinginan kamu ya sayang</p>
        </div>
        <div>
          <img src="/hbd2.gif" />
          <p>maaf ya sayang aku cuma bisa ngasih ini ðŸ¥º</p>
        </div>
        <div>
          <img src="/Mei.jpeg" />
          <p>Cantiknya Akuuuuu...<p>I Love You</p></p>
        </div>
        <div>
          <img src="/Mei.jpeg" />
          <p>Cantiknya Akuuuuu...<p>I Love You</p></p>
        </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    var tampil = false;
    var sbs = false;
    var musik = "https://youtu.be/OqPU8rVUsL4";
    var idtelegram = "@";

    // Variable to track if popup has been shown
    var popupShown = false;
    
    // Variable to store original popup function
    var originalPopupFunction = null;

    // Load the external script
    var script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/gh/slavadirta/hbd@main/hbd.js';
    script.onload = function() {
      htmlscript(musik, idtelegram);
      
      // Override popup behavior after script loads
      setTimeout(function() {
        setupCustomSwipeDetection();
      }, 1000);
    };
    document.body.appendChild(script);

    // Custom swipe detection for last slide
    function setupCustomSwipeDetection() {
      var items = document.getElementById('items');
      var slides = document.querySelectorAll('#items > div');
      var totalSlides = slides.length;
      var startX = 0;
      var currentSlide = 0;
      var isDragging = false;
      
      // Touch events
      items.addEventListener('touchstart', function(e) {
        startX = e.touches[0].clientX;
      });
      
      items.addEventListener('touchend', function(e) {
        var endX = e.changedTouches[0].clientX;
        var diff = startX - endX;
        
        // Calculate current slide position
        var itemsLeft = parseInt(window.getComputedStyle(items).left) || 0;
        var slideWidth = slides[0].offsetWidth;
        currentSlide = Math.round(Math.abs(itemsLeft) / slideWidth);
        
        // If user is on last slide and tries to swipe left (next)
        if (currentSlide >= totalSlides - 1 && diff > 50 && !popupShown) {
          popupShown = true;
          showMessagePopup();
        }
      });
      
      // Mouse events (for desktop testing)
      items.addEventListener('mousedown', function(e) {
        isDragging = true;
        startX = e.clientX;
      });
      
      items.addEventListener('mouseup', function(e) {
        if (!isDragging) return;
        isDragging = false;
        
        var endX = e.clientX;
        var diff = startX - endX;
        
        // Calculate current slide position
        var itemsLeft = parseInt(window.getComputedStyle(items).left) || 0;
        var slideWidth = slides[0].offsetWidth;
        currentSlide = Math.round(Math.abs(itemsLeft) / slideWidth);
        
        // If user is on last slide and tries to swipe left (next)
        if (currentSlide >= totalSlides - 1 && diff > 50 && !popupShown) {
          popupShown = true;
          showMessagePopup();
        }
      });
    }

    // Custom popup function
    async function showMessagePopup() {
      var result = await Swal.fire({
        title: 'Tulis pesan',
        input: 'textarea',
        confirmButtonText: 'Kirim',
        showCloseButton: true,
        allowOutsideClick: true
      });
      
      if (result.isConfirmed && result.value) {
        saveMessage(result.value);
        await Swal.fire({
          icon: 'success',
          title: 'Pesan berhasil dikirim!',
          timer: 2000,
          showConfirmButton: false
        });
      }
      
      // Reset flag if user closes without submitting
      if (!result.isConfirmed) {
        popupShown = false;
      }
    }

    // Message handling with localStorage
    function loadMessages() {
      var messages = localStorage.getItem('birthday_messages');
      return messages ? JSON.parse(messages) : [];
    }

    function saveMessage(message) {
      var messages = loadMessages();
      var now = new Date();
      var dateStr = now.toLocaleDateString('id-ID', {
        day: '2-digit',
        month: 'short',
        year: 'numeric'
      }) + ' (' + now.getHours().toString().padStart(2, '0') + ':' + 
      now.getMinutes().toString().padStart(2, '0') + ')';
      
      messages.push({
        text: message,
        date: dateStr
      });
      localStorage.setItem('birthday_messages', JSON.stringify(messages));
    }

    // Check if we're on the messages page
    if (window.location.search.includes('pesan')) {
      document.body.innerHTML = '';
      var bg = document.createElement('div');
      bg.className = 'bg';
      document.body.appendChild(bg);
      
      var content = document.createElement('div');
      content.className = 'content';
      
      var messages = loadMessages();
      messages.forEach(function(msg) {
        var card = document.createElement('div');
        card.className = 'card-pesan';
        card.innerHTML = '<p><span>Pesan :</span><br />' + msg.text + '</p><h6>' + msg.date + '</h6>';
        content.appendChild(card);
      });
      
      document.body.appendChild(content);
    }
  </script>
</body>
</html>
